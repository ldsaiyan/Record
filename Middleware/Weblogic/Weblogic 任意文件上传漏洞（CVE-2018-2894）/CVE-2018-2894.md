# Weblogic 任意文件上传漏洞（CVE-2018-2894）

## 介绍
Weblogic管理端未授权的两个页面存在任意上传jsp文件的漏洞，进而能获得服务器的权限

问题页面：/ws_utc/begin.do 和 /ws_utc/config.do
影响版本：Weblogic 10.3.6.0，Weblogic 12.1.3.0，Weblogic 12.2.1.2，Weblogic 12.2.1.3

Oracle 7月更新中，修复了Weblogic Web Service Test Page中一处任意文件上传漏洞，Web Service Test Page 在 ‘生产模式’ 下默认不开启，所以该漏洞有一定限制。

注意：
开发模式：进入ws_utc/config.do无需认证
生产模式：进入ws_utc/config.do需要认证

## 环境
CentOS7
Vulhub

## 使用docker环境搭建vulhub环境
Docker安装、Docker-compose安装以及Vulhub的下载，参考https://vulhub.org文档。

## 漏洞复现
进入vulhub/weblogic目录下，找到CVE-2018-2894进去，执行
```
docker-compose up -d
```
启动weblogic 12.2.1.3,访问http://your-ip:7001/console就能进入后台管理登录页面。

执行
```
docker-compose logs | grep password
```
可查看管理员密码，管理员用户名为weblogic，输入密码，进去。

按照提示点击

![](https://github.com/saiyanlee/Record/blob/master/Sys/Weblogic/Weblogic%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2018-2894%EF%BC%89/images/1.png)

然后选择高级，找到这个红框的地方勾上

![](https://github.com/saiyanlee/Record/blob/master/Sys/Weblogic/Weblogic%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2018-2894%EF%BC%89/images/2.png)

进入问题页面/ws_utc/config.do

![](https://github.com/saiyanlee/Record/blob/master/Sys/Weblogic/Weblogic%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2018-2894%EF%BC%89/images/3.png)

设置Work Home Dir为：/u01/oracle/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/com.oracle.webservices.wls.ws-testclient-app-wls/4mcj4y/war/css

![](https://github.com/saiyanlee/Record/blob/master/Sys/Weblogic/Weblogic%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2018-2894%EF%BC%89/images/4.png)

访问这个目录是不需要权限的，这是关键。

进入“安全”，点击“添加”，之后上传JSP木马（账号密码随意设置）

![](https://github.com/saiyanlee/Record/blob/master/Sys/Weblogic/Weblogic%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2018-2894%EF%BC%89/images/5.png)

访问http://your-ip:7001/ws_utc/css/config/keystore/[时间戳]_[文件名]，即可执行

而时间戳可以通过抓包或者按f12使用审查元素来找到

![](https://github.com/saiyanlee/Record/blob/master/Sys/Weblogic/Weblogic%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2018-2894%EF%BC%89/images/6.png)

蚁剑连接


## 防范
设置config.do,begin.do页面登录授权后访问
IPS等防御产品可以加入相应的特征
升级到官方的最新版本